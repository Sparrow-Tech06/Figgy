<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sprint Duels</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  margin:0;
  background:#0e0f13;
  color:#fff;
  font-family:system-ui,sans-serif;
}

/* ===== MENU OVERLAY ===== */
#menuOverlay{
  position:fixed;
  inset:0;
  background:#0e0f13;
  z-index:999;
  padding:24px;
  display:flex;
  flex-direction:column;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

.menu-top{
  display:flex;
  justify-content:space-between;
}
.icon-btn{
  background:#151821;
  border:1px solid #1f2433;
  color:#fff;
  padding:10px 16px;
  border-radius:12px;
}

.menu-center{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

.badge{
  background:#1f2433;
  color:#f2a93b;
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  width:max-content;
}

.menu h1{
  font-size:56px;
  font-weight:800;
  line-height:1;
  margin:16px 0 8px;
}

.subtitle{color:#9aa0b5}

.menu-card{
  background:#151821;
  border:1px solid #1f2433;
  border-radius:16px;
  padding:14px;
  margin:28px 0;
}

.start-btn{
  width:100%;
  background:#f2a93b;
  border:none;
  padding:16px;
  font-weight:700;
  border-radius:16px;
}

/* ===== GAME UI ===== */
#gameUI{
  display:none;
  animation:fadeIn .4s ease;
}

.card-dark{
  background:#151821;
  border:1px solid #1f2433;
  border-radius:16px;
}

.option{
  background:#0e111b;
  border:1px solid #252a3d;
  border-radius:14px;
  padding:14px;
  text-align:center;
  cursor:pointer;
  transition:.2s;
}
.option:hover{background:#1b2030}
.correct{background:#0f5132}
.wrong{background:#842029}
</style>
</head>

<body>

<!-- ========== MENU OVERLAY ========== -->
<div id="menuOverlay">

  <div class="menu-top">
    <button class="icon-btn" onclick="window.history.back()">‚Üê</button>
    <button class="icon-btn" onclick="alert('Solve the pattern & choose the correct option')">
      How to Play
    </button>
  </div>

  <div class="menu-center menu">
    <span class="badge">MATH ¬∑ 1 MIN DUEL</span>

    <h1>SPRINT<br>DUELS</h1>
    <p class="subtitle">Race to solve the most in 1 minute</p>

    <div class="menu-card">
      <div class="d-flex justify-content-between align-items-center">
        <span>‚è± Timer</span>
        <input type="checkbox" id="timerToggle" checked>
      </div>
    </div>

    <button class="start-btn" onclick="startGame()">START DUEL</button>
  </div>
</div>

<!-- ========== GAME UI ========== -->
<div id="gameUI" class="container py-3">

  <div class="card-dark p-3 mb-3">
    <div class="d-flex justify-content-between">
      <span>Score: <b id="score">0</b></span>
      <span id="timerBox">Time: <b id="timer">40</b>s</span>
    </div>
    <div class="text-secondary mt-1" id="progressText">1 / 10</div>
  </div>

  <div class="card-dark p-3">
    <div class="text-center mb-3">
      <h4 id="pattern"></h4>
    </div>

    <div class="row g-3" id="options"></div>

    <!-- SUBMIT ONLY FOR NO-TIMER MODE -->
    <button id="submitBtn"
      class="btn btn-outline-danger w-100 mt-3"
      onclick="endGame()">
      Submit & End
    </button>
  </div>
</div>

<script>
/* ===== DATA ===== */
const patterns=[
 {s:[2,4,6,'?'],a:8,o:[6,8,10,12]},
 {s:[1,4,9,'?'],a:16,o:[12,16,18,25]},
 {s:[3,6,12,'?'],a:24,o:[18,20,24,30]}
];

let timerOn=true;
let score=0,index=0;
const total=10;
let timerInterval;

/* ===== START GAME ===== */
function startGame(){
  timerOn=document.getElementById('timerToggle').checked;

  document.getElementById('menuOverlay').style.display='none';
  document.getElementById('gameUI').style.display='block';

  document.getElementById('submitBtn').style.display =
    timerOn ? 'none' : 'block';

  if(timerOn) startTimer();
  else document.getElementById('timerBox').style.display='none';

  loadQuestion();
}

/* ===== GAME ===== */
function loadQuestion(){
  if(index>=total){
    endGame(); // üî• FIXED BUG
    return;
  }

  const p=patterns[Math.floor(Math.random()*patterns.length)];
  document.getElementById('pattern').textContent=p.s.join(' ');
  document.getElementById('progressText').textContent=`${index+1} / ${total}`;

  const box=document.getElementById('options');
  box.innerHTML='';

  p.o.sort(()=>Math.random()-0.5).forEach(v=>{
    const c=document.createElement('div');
    c.className='col-6';
    c.innerHTML=`<div class="option">${v}</div>`;
    c.onclick=()=>{
      if(v===p.a){
        score++;
        c.firstChild.classList.add('correct');
      }else{
        c.firstChild.classList.add('wrong');
      }
      document.getElementById('score').textContent=score;
      index++;
      setTimeout(loadQuestion,500);
    };
    box.appendChild(c);
  });
}

/* ===== TIMER ===== */
function startTimer(){
  let t=40;
  timerInterval=setInterval(()=>{
    t--;
    document.getElementById('timer').textContent=t;
    if(t<=0){
      clearInterval(timerInterval);
      endGame();
    }
  },1000);
}

/* ===== END GAME ===== */
function endGame(){
  clearInterval(timerInterval);
  localStorage.setItem('gameResult',JSON.stringify({
    score,total,mode:timerOn?'Timer':'Practice'
  }));
  location.href='https://sparrow-tech06.github.io/Figgy/result.html';
}
</script>

</body>
</html>
