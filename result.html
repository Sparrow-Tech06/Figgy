<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Game Result</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js"></script>

<style>
:root{
  --bg:#ffffff;
  --card:none;
  --text:#1e1f24;
  --muted:#6c757d;
  --border:#e6e8ef;
  --primary:#4f46e5;
  --radius:18px;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f1115;
    --card:#1d2129;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --border:#2f3750;
  }
}
body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}
.result-wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.result-card{
  width:100%;
  max-width:420px;
  padding:28px;
  text-align:center;
  animation:fade .35s ease;
}
@keyframes fade{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1}
}
.game-name{font-size:14px;color:var(--muted)}
.score{font-size:48px;font-weight:800;margin:14px 0 6px}
.percent{color:var(--muted);margin-bottom:26px}
.btn-outline{
  border:1px solid var(--border);
  padding:14px;
  border-radius:14px;
  font-weight:600;
  background:var(--primary);
  color:#fff;
  margin-top:30px;
}

/* CONFETTI */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:9999}
.confetti{
  position:absolute;
  top:-12px;
  animation:fall cubic-bezier(.23,.61,.35,1) forwards;
}
@keyframes fall{
  to{
    transform:translateY(110vh) rotate(720deg);
    opacity:0;
  }
}
</style>
</head>

<body>

<div id="confetti"></div>

<div class="result-wrapper">
  <div class="result-card">
    <div class="game-name" id="gameName">Game</div>
    <div class="score" id="score">0 / 0</div>
    <div class="percent" id="percent">0%</div>

    <button class="btn btn-outline w-100" onclick="goBack()">Back to Menu</button>
  </div>
</div>

<script>
/* ========= DATA ========= */
const score    = Number(localStorage.getItem('lastScore') || 0);
const total    = Number(localStorage.getItem('lastTotal') || 0);
const gameName = localStorage.getItem('lastGame') || 'Game';

/* ========= UI ========= */
document.getElementById('gameName').innerText = gameName;
document.getElementById('score').innerText = `${score} / ${total}`;
const percent = total ? Math.round((score/total)*100) : 0;
document.getElementById('percent').innerText = `${percent}% Accuracy`;

/* ========= SOUND ========= */
if(localStorage.getItem('soundOn') === '1'){
  new Howl({
    src:['assets/sound/correct.mp3'],
    volume:.6
  }).play();
}

/* ========= CONFETTI ========= */
(function(){
  const wrap=document.getElementById('confetti');
  for(let i=0;i<120;i++){
    const d=document.createElement('div');
    d.className='confetti';
    d.style.left=Math.random()*100+'vw';
    d.style.width=d.style.height=(6+Math.random()*6)+'px';
    d.style.background=['#4f46e5','#22c55e','#f59e0b','#ef4444'][i%4];
    d.style.animationDuration=(4+Math.random()*2)+'s';
    wrap.appendChild(d);
  }
  setTimeout(()=>wrap.remove(),6500);
})();

/* ========= ONE-TIME REWARD (RESULT PAGE ONLY) ========= */
(function rewardOnce(){

  // create or reuse session key
  let sessionKey = sessionStorage.getItem('resultRewardKey');

  if(!sessionKey){
    sessionKey = 'res_' + Date.now() + '_' + Math.random().toString(36).slice(2);
    sessionStorage.setItem('resultRewardKey', sessionKey);
  }

  const lockKey = 'rewarded_' + sessionKey;

  // already rewarded
  if(localStorage.getItem(lockKey)==='1') return;

  // give reward
  if(typeof getCoin === 'function'){
    getCoin(10, gameName);
  }

  // lock permanently
  localStorage.setItem(lockKey,'1');

})();

/* ========= NAV ========= */
function goBack(){
  sessionStorage.removeItem('resultRewardKey'); // reset for next game
  history.back();
}
</script>

</body>
</html>

